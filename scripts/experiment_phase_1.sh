#!/usr/bin/env bash

python /home/john/SpectroscopyModel/generate.py --savedir '/home/john/SpectroscopyModel/dataset/dataset_' --totalEntries 200000 --phase 'train'
python /home/john/SpectroscopyModel/generate_simplified.py --savedir '/home/john/SpectroscopyModel/dataset/simplified_dataset_' --totalEntries 100000 --phase 'train'

mv ./dataset__spectra.mat ./dataset_spectra.mat
mv ./dataset__magnitude.mat ./dataset_magnitude.mat
mv ./dataset__parameters.mat ./dataset_parameters.mat
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_010' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --cropped_signal --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50'    --split --test_split 0. --parameters --metabolites --lambda_metab 1  --phase_data_path '/home/john/SpectroscopyModel/dataset'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_011' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 1  --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --lr_method 'cosine'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_011F' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 1  --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --flexible --lr_method 'cosine'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_020' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50'    --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup  --lr_method 'cosine'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_001' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --parameters --metabolites --lambda_metab 1  --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --lr_method 'cosine'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_001-18' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet18' --parameters --metabolites --lambda_metab 1  --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --lr_method 'cosine'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_002-18' --phase 'train' --save_latest_freq 17500 --print_freq 8750 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet18' --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --lr_method 'cosine'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_030' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --cropped_signal --lr 0.0001 --G0 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'densenet169' --parameters --metabolites --lambda_metab 1 --phase_data_path '/home/john/SpectroscopyModel/dataset' --lr_method 'cosine' --warmup 1
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_040' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --cropped_signal --lr 0.0001 --G0 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'densenet169' --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset' --lr_method 'cosine' --warmup 1

#python /home/john/SpectroscopyModel/train.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'forward' --file_ext '.mat' --name 'Phase03_test_010' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --cropped_signal --lr 0.0001 --G0 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet' --depth 1 --n_blocks 6 --parameters --metabolites --lambda_metab 1 --phase_data_path '/home/john/SpectroscopyModel/dataset'
#python /home/john/SpectroscopyModel/train.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'forward' --file_ext '.mat' --name 'Phase03_test_020' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --cropped_signal --lr 0.0001 --G0 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet' --depth 1 --n_blocks 6 --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset'
#python /home/john/SpectroscopyModel/train.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'forward' --file_ext '.mat' --name 'Phase03_test_030' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --cropped_signal --lr 0.0001 --G0 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'lgresnet' --depth 1 --n_blocks 6 --parameters --metabolites --lambda_metab 1 --phase_data_path '/home/john/SpectroscopyModel/dataset' --lr_method 'cosine' --warmup 1
#python /home/john/SpectroscopyModel/train.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'forward' --file_ext '.mat' --name 'Phase03_test_040' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --cropped_signal --lr 0.0001 --G0 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'lgresnet' --depth 1 --n_blocks 6 --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset' --lr_method 'cosine' --warmup 1



python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'debugging' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 5 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet18' --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --lr_method 'cosine'



python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'resnet18_w_sigmoid_simp' --phase 'train' --save_latest_freq 17500 --print_freq 8750 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --magnitude --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset_Simplified' --which_model_netEst 'resnet18' --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --lr_method 'cosine'


python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_012' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 150 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G0 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 10  --phase_data_path '/home/john/SpectroscopyModel/dataset'

python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_003' --phase 'train' --save_latest_freq 28000 --print_freq 28000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --parameters --metabolites --lambda_metab 1  --phase_data_path '/home/john/SpectroscopyModel/dataset' --lr_method 'cosine'





python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_010' --phase 'train' --save_latest_freq 28000 --print_freq 14000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 1 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G1 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --split --test_split 0. --parameters --metabolites --lambda_metab 1
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_002' --phase 'train' --save_latest_freq 20000 --print_freq 2500 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G2 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --split --test_split 0.  --parameters --metabolites --lambda_metab 1

python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase01_test_003' --phase 'train' --save_latest_freq 20000 --print_freq 2500 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G1 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --split --test_split 0.  --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset'


# # # >>> Training size reduced to 100,000 spectra
python /home/john/SpectroscopyModel/generate.py --savedir '/home/john/SpectroscopyModel/dataset/dataset' --totalEntries 100000 --phase 'train'

python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_020' --phase 'train' --save_latest_freq 16000 --print_freq 4000 --no_flip --batchSize 320 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G1 --plot_grads --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 10 --split --test_split 0.
 --phase_data_path '/home/john/SpectroscopyModel/dataset'

python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_010' --phase 'train' --save_latest_freq 16000 --print_freq 4000 --no_flip --batchSize 320 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G1 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset'
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_010' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G1 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --parameters --metabolites --lambda_metab 10 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup



python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_010F' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 75 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0001 --G1 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --flexible


#debug: /home/john/SpectroscopyModel/models/auxiliary.py:292: MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance.  In a future version, a new instance will always be created and returned.  Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance.
#  plt.axes().set_aspect('auto')

# # # 08.17.2020
'''
Networks are not learning anything - loss stays around 20 except at the beginning when warmup is used
Increasing the learning rate helped. 0.005 worked, but has strange peaks at the beginning of each epoch.
Cut it back to 0.0025 and it seems to be working well.
I also reduced the parameter lambda to 5
It seems to be having trouble learning the phase correction, so I added a separate phase penalty with lambda=2
'''
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_011' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.0005 --G1 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_021' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 125 --checkpoints_dir './tests' --n_epochs 40 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.00025 --G2 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_021' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 250 --checkpoints_dir './tests' --n_epochs 40 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.00025 --G1 --G2 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_022' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 250 --checkpoints_dir './tests' --n_epochs 100 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.00025 --G1 --G2 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --phase_loss --lambda_phase 2
'''
Running for 100 epochs lead to good results.
R2 values:
    Baseline ~0.75
    Parameters ~0.82
    Overall ~0.85
    Baseline/Phase/F_shift ~0.95
    Metabolites ~0.98/0.99
    Noise ~0.25
    Metabolites are learned well and rather quickly.
    The phase starts out well and then tapers off slightly (~60 degree slope) for 17 epochs. Hits 0.8 and slows down dramatically.
    The Noise stays relatively close to 0 the whole time.
    The frequency shift stays below 0.05 for the first ~32 epochs and then picks up drastically for 20 epochs. Then it performs the same as the phase.
    Line broadening and Baseline start out decent for ~7 epochs and then begin tapping off. The Baseline eventually
        catches up to phase and f_shift. But T2 maxes out around 0.77
'''

python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_012' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 500 --checkpoints_dir './tests' --n_epochs 30 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.00025 --G2 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet34' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup


# # # 08.18.2020
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_023' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 125 --checkpoints_dir './tests' --n_epochs 500 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.00025 --G2 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnet50' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --phase_loss --lambda_phase 2

python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_040' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 125 --checkpoints_dir './tests' --n_epochs 50 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.00025 --G2 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'resnext50' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --phase_loss --lambda_phase 2


# # # 08.19.2020
python /home/john/SpectroscopyModel/train_condensed.py --dataroot '/home/john/SpectroscopyModel/dataset' --model 'fitting' --file_ext '.mat' --name 'Phase02_test_050' --phase 'train' --save_latest_freq 20000 --print_freq 5000 --no_flip --batchSize 125 --checkpoints_dir './tests' --n_epochs 100 --n_epochs_decay 0 --quiet --normalize --actvn 'relu' --lr 0.00025 --G2 --dataset_mode 'LabeledMatSpectralDataset' --which_model_netEst 'wideresnet' --parameters --metabolites --lambda_metab 5 --phase_data_path '/home/john/SpectroscopyModel/dataset' --warmup --phase_loss --lambda_phase 2
